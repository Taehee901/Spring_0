<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
</head>
<body>
<header class="bg-light py-3 mb-4">
    <div class="container">
        <h3 class="text-center">도서대여관리</h3>
        <nav>
            <ul class="nav justify-content-center">
                <li class="nav-item"><a class="nav-link" th:href="@{/bookAdd}">도서등록</a></li>
                <li class="nav-item"><a class="nav-link" th:href="@{/bookList}">도서목록조회/수정</a></li>
                <li class="nav-item"><a class="nav-link" th:href="@{/bookJoin}">대여현황조회</a></li>
                <li class="nav-item"><a class="nav-link" th:href="@{/}">홈으로</a></li>
            </ul>
        </nav>
    </div>
</header>
<h2>도서 조회/수정</h2>
<a th:href="@{/bookAdd}" class="btn btn-primary mb-3">등록</a>
<table class="table">
<tr th:each="book : ${bookList}" >
	<td th:text="${book.bookNo}"></td>
	<td><a th:href="@{/book(bookNo=${book.bookNo})}" th:text="${book.bookName}"></td>
	<td><img th:src="'/images/'+${book.bookCoverimg}" style="width: 80px; height: auto;" ></td>
	<td th:text="${#dates.format(book.bookDate,'yyyy-MM-dd')}"></td>
	<td th:text="${book.bookPrice}"></td>
	<td th:text="${book.bookPrice}"></td>
	<td th:text="${book.bookPublisher}"></td>
    <td th:text="${book.bookInfo}"></td>
	<td><button type="button" class="btn btn-danger delete" th:attr="data-bookno=${book.bookNo}">삭제</button></td>
</tr>
</table>
</body>
<script>
document.querySelectorAll(".delete").forEach(btn => {
	  btn.addEventListener("click", function(event) {
	    const bookNo = event.target.dataset.bookno;

	    if(!confirm("삭제할까요?")) {
	      return;
	    }

	    fetch(`/bookRemove/${bookNo}`, { method: "delete" })
		  .then((res) => res.json())
	      .then(data => {
	        if(data.ok) {
	          // tr 삭제
	          event.target.closest("tr").remove();
	        } else {
	          alert("삭제 실패");
	        }
	      });
	  });
	});
</script>
</html>